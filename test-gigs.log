-----------------------------------------------------------------------------------------------------------------------------------------------
      name:  GIGS Testing
       log:  D:\Users\tadeo\Documents\gigs-stata\test-gigs.log
  log type:  text
 opened on:  19 Nov 2024, 09:38:21

. 
. //  1. Generate .dta files with standards using "z2v/c2v" conversions,
. //     and with .dta files to be tested against R dataframes
. local outputs "tests/outputs"

. cap mkdir "`outputs'"

. foreach aspect in "who_gs" "ig_nbs" "ig_nbs_ext" "ig_png" "ig_fet" ///
>     "interpolation" "z_lgls" "classification" {
  2.         cap mkdir "`outputs'/`aspect'"
  3.         noi di "Running .dta file generation for `aspect'"
  4.         frames reset
  5.         run "tests/test-`aspect'.do"
  6. }
Running .dta file generation for who_gs
Running .dta file generation for ig_nbs
Running .dta file generation for ig_nbs_ext
Running .dta file generation for ig_png
Running .dta file generation for ig_fet
Running .dta file generation for interpolation
Running .dta file generation for z_lgls
Running .dta file generation for classification

. 
. //  2. Compare to standards in gigs R package
. //              a. n.b. Install rsource (R from Stata) if not already installed:
. //                 . cap ssc install rsource, replace
. local test_rscript "tests/test_stata_outputs.R"

. if "`c(os)'"=="MacOSX" | "`c(os)'"=="UNIX" {
.     noi rsource using "`test_rscript'", ///
>                 noloutput ///
>                 rpath("/usr/local/bin/R") ///
>                 roptions(`"--vanilla"')
. }

. else if "`c(os)'"=="Windows" { 
.         // Windows
.         // n.b. Set `rversion' to that of own system - n.b. gigs needs R >=4.1.0
.         local rversion "4.3.3" 
.         noi rsource using "`test_rscript'", ///
>                 noloutput ///
>                 rpath("C:\Program Files\R\R-`rversion'\bin\x64\Rterm.exe") ///
>                 roptions("--vanilla")
Assumed R program path: "C:\Program Files\R\R-4.3.3\bin\x64\Rterm.exe"

── INTERGROWTH-21st Fetal Growth Standards ─────────────────────────────────────
✔ Centiles in hcfga: succeeded
✔ Z-scores in hcfga: succeeded
✔ Centiles in bpdfga: succeeded
✔ Z-scores in bpdfga: succeeded
✔ Centiles in acfga: succeeded
✔ Z-scores in acfga: succeeded
✔ Centiles in flfga: succeeded
✔ Z-scores in flfga: succeeded
✔ Centiles in ofdfga: succeeded
✔ Z-scores in ofdfga: succeeded
✔ Centiles in efwfga: succeeded
✔ Z-scores in efwfga: succeeded
✔ Centiles in sfhfga: succeeded
✔ Z-scores in sfhfga: succeeded
✔ Centiles in crlfga: succeeded
✔ Z-scores in crlfga: succeeded
✔ Centiles in gafcrl: succeeded
✔ Z-scores in gafcrl: succeeded
✔ Centiles in gwgfga: succeeded
✔ Z-scores in gwgfga: succeeded
✔ Centiles in pifga: succeeded
✔ Z-scores in pifga: succeeded
✔ Centiles in rifga: succeeded
✔ Z-scores in rifga: succeeded
✔ Centiles in sdrfga: succeeded
✔ Z-scores in sdrfga: succeeded
✔ Centiles in tcdfga: succeeded
✔ Z-scores in tcdfga: succeeded
✔ Centiles in gaftcd: succeeded
✔ Z-scores in gaftcd: succeeded
✔ Centiles in poffga: succeeded
✔ Z-scores in poffga: succeeded
✔ Centiles in sffga: succeeded
✔ Z-scores in sffga: succeeded
✔ Centiles in avfga: succeeded
✔ Z-scores in avfga: succeeded
✔ Centiles in pvfga: succeeded
✔ Z-scores in pvfga: succeeded
✔ Centiles in cmfga: succeeded
✔ Z-scores in cmfga: succeeded
✔ Centiles in hefwfga: succeeded
✔ Z-scores in hefwfga: succeeded

── INTERGROWTH-21st Newborn Size Standards ─────────────────────────────────────
✔ Male zscores in wfga: succeeded
✔ Male centiles in wfga: succeeded
✔ Female zscores in wfga: succeeded
✔ Female centiles in wfga: succeeded
✔ Male zscores in lfga: succeeded
✔ Male centiles in lfga: succeeded
✔ Female zscores in lfga: succeeded
✔ Female centiles in lfga: succeeded
✔ Male zscores in hcfga: succeeded
✔ Male centiles in hcfga: succeeded
✔ Female zscores in hcfga: succeeded
✔ Female centiles in hcfga: succeeded
✔ Male zscores in wlrfga: succeeded
✔ Male centiles in wlrfga: succeeded
✔ Female zscores in wlrfga: succeeded
✔ Female centiles in wlrfga: succeeded
ℹ File not found: 'tests/outputs/ig_nbs/ffmfga_z2v_male.dta'
✔ Male centiles in ffmfga: succeeded
ℹ File not found: 'tests/outputs/ig_nbs/ffmfga_z2v_female.dta'
✔ Female centiles in ffmfga: succeeded
ℹ File not found: 'tests/outputs/ig_nbs/bfpfga_z2v_male.dta'
✔ Male centiles in bfpfga: succeeded
ℹ File not found: 'tests/outputs/ig_nbs/bfpfga_z2v_female.dta'
✔ Female centiles in bfpfga: succeeded
ℹ File not found: 'tests/outputs/ig_nbs/fmfga_z2v_male.dta'
✔ Male centiles in fmfga: succeeded
ℹ File not found: 'tests/outputs/ig_nbs/fmfga_z2v_female.dta'
✔ Female centiles in fmfga: succeeded

── Extended INTERGROWTH-21st Newborn Size Standards ────────────────────────────
✔ Male zscores in wfga: succeeded
✔ Male centiles in wfga: succeeded
✔ Female zscores in wfga: succeeded
✔ Female centiles in wfga: succeeded
✔ Male zscores in lfga: succeeded
✔ Male centiles in lfga: succeeded
✔ Female zscores in lfga: succeeded
✔ Female centiles in lfga: succeeded
✔ Male zscores in hcfga: succeeded
✔ Male centiles in hcfga: succeeded
✔ Female zscores in hcfga: succeeded
✔ Female centiles in hcfga: succeeded

── INTERGROWTH-21st Postnatal Growth Standards ─────────────────────────────────
✔ Male centiles in wfa: succeeded
✔ Female centiles in wfa: succeeded
✔ Male centiles in lfa: succeeded
✔ Female centiles in lfa: succeeded
✔ Male centiles in hcfa: succeeded
✔ Female centiles in hcfa: succeeded
✔ Male centiles in wfl: succeeded
✔ Female centiles in wfl: succeeded

── WHO Child Growth Standards ──────────────────────────────────────────────────
✔ Male centiles in wfa: succeeded
✔ Female centiles in wfa: succeeded
✔ Male centiles in bfa: succeeded
✔ Female centiles in bfa: succeeded
✔ Male centiles in lhfa: succeeded
✔ Female centiles in lhfa: succeeded
✔ Male centiles in wfl: succeeded
✔ Female centiles in wfl: succeeded
✔ Male centiles in wfh: succeeded
✔ Female centiles in wfh: succeeded
✔ Male centiles in hcfa: succeeded
✔ Female centiles in hcfa: succeeded
✔ Male centiles in acfa: succeeded
✔ Female centiles in acfa: succeeded
✔ Male centiles in ssfa: succeeded
✔ Female centiles in ssfa: succeeded
✔ Male centiles in tsfa: succeeded
✔ Female centiles in tsfa: succeeded

── Interpolation of coefficients ───────────────────────────────────────────────
✔ Interpolation is consistent for males in WHO GS `wfa`.
✔ Interpolation is consistent for females in WHO GS `wfa`.
✔ Interpolation is consistent for males in WHO GS `bfa`.
✔ Interpolation is consistent for females in WHO GS `bfa`.
✔ Interpolation is consistent for males in WHO GS `lhfa`.
✔ Interpolation is consistent for females in WHO GS `lhfa`.
✔ Interpolation is consistent for males in WHO GS `wfl`.
✔ Interpolation is consistent for females in WHO GS `wfl`.
✔ Interpolation is consistent for males in WHO GS `wfh`.
✔ Interpolation is consistent for females in WHO GS `wfh`.
✔ Interpolation is consistent for males in WHO GS `hcfa`.
✔ Interpolation is consistent for females in WHO GS `hcfa`.
✔ Interpolation is consistent for males in WHO GS `acfa`.
✔ Interpolation is consistent for females in WHO GS `acfa`.
✔ Interpolation is consistent for males in WHO GS `ssfa`.
✔ Interpolation is consistent for females in WHO GS `ssfa`.
✔ Interpolation is consistent for males in WHO GS `tsfa`.
✔ Interpolation is consistent for females in WHO GS `tsfa`.
✔ Interpolation is consistent for males in IG NBS `wfga`.
✔ Interpolation is consistent for females in IG NBS `wfga`.
✔ Interpolation is consistent for males in IG NBS `lfga`.
✔ Interpolation is consistent for females in IG NBS `lfga`.
✔ Interpolation is consistent for males in IG NBS `hcfga`.
✔ Interpolation is consistent for females in IG NBS `hcfga`.

── GIGS z-scoring logicals ─────────────────────────────────────────────────────
✔ GIGS zscoring logicals are consistent.
Warning messages:
1: In compare_gigs_z_lgls() :
  There were 7 'at birth' observations where `age_days` > 0.5.
ℹ This occurred for IDs 83, 312, 377, 678, 736, 838, and 916.
2: In compare_gigs_z_lgls() :
  There was 1 birth observation where `gest_age` > 300. The WHO Growth standards
were used for this observation instead of the INTERGROWTH-21st Newborn Size
standards.
ℹ This occurred for ID 874.

── GIGS classification ─────────────────────────────────────────────────────────
! Unused factor levels kept after small vulnerable newborn categorisation:
"Term LGA".
! Unused factor levels kept after weight-for-age (underweight) categorisation:
"outlier".
✔ GIGS classification is consistent.
Warning message:
In eval(substitute(expr), data, enclos = parent.frame()) :
  There were 134 'at birth' observations where `age_days` > 0.5.
ℹ This occurred for IDs 2, 3, 6, 7, 12, 13, 14, 16, 20, 21, 22, 23, 24, …, 295,
  and 298.

── Overall ─────────────────────────────────────────────────────────────────────
✔ All tests passed!
. }

. 
. // Stop logging
. log close
no log file open
r(606);

end of do-file

r(606);

. view "D:\Users\tadeo\Documents\gigs-stata\test-gigs.log"

