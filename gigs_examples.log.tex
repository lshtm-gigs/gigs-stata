. use life6mo
{\smallskip}
. gen agedays = pma - gestage
{\smallskip}
. local 37weeks 7 * 37
{\smallskip}
. list in f/10, noobs abbreviate(10) sep(10)
{\smallskip}
  {\TLC}\HLI{69}{\TRC}
  {\VBAR}   infantid   gestage   pma   sex   visitweek   meaninfwgt   agedays {\VBAR}
  {\LFTT}\HLI{69}{\RGTT}
  {\VBAR} 101-1002-1       132   133     2           0         2300         1 {\VBAR}
  {\VBAR} 101-1002-1       132   139     2           1         2270         7 {\VBAR}
  {\VBAR} 101-1002-1       132   146     2           2         2465        14 {\VBAR}
  {\VBAR} 101-1002-1       132   162     2           4         2700        30 {\VBAR}
  {\VBAR} 101-1002-1       132   174     2           6         3160        42 {\VBAR}
  {\VBAR} 101-1002-1       132   203     2          10         4004        71 {\VBAR}
  {\VBAR} 101-1002-1       132   230     2          14     4893.333        98 {\VBAR}
  {\VBAR} 101-1002-1       132   258     2          18         5690       126 {\VBAR}
  {\VBAR} 101-1002-1       132   317     2          26         6950       185 {\VBAR}
  {\VBAR} 101-1003-1       237   238     1           0         1900         1 {\VBAR}
  {\BLC}\HLI{69}{\BRC}
{\smallskip}
. 
. egen double waz_nbs = ig_nbs(meaninfwgt/1000, "wfga", "v2z") ///
>     if agedays == 0, ///
>     gest_days(gestage) sex(sex) sexcode(m=1, f=2)
(8,228 missing values generated)
{\smallskip}
. 
. egen double waz_who = who_gs(meaninfwgt/1000, "wfa", "v2z") ///
>     if agedays > 0 \& gestage >= `37weeks', ///
>     xvar(agedays) sex(sex) sexcode(m=1, f=2)
(4,073 missing values generated)
{\smallskip}
.         
. gen pma_weeks = pma / 7
{\smallskip}
. gen pma_weeks_floored = floor(pma / 7)
{\smallskip}
. egen double waz_png = ig_png(meaninfwgt/1000, "wfa", "v2z") ///
>     if gestage < `37weeks' \& agedays > 0, ///
>     xvar(pma_weeks_floored) sex(sex) sexcode(m=1, f=2)
(4,659 missing values generated)
{\smallskip}
. drop pma_weeks pma_weeks_floored
{\smallskip}
. 
. gen double waz = waz_who if gestage > `37weeks'
(4,749 missing values generated)
{\smallskip}
. replace waz = waz_png if gestage < `37weeks'
(3,757 real changes made)
{\smallskip}
. replace waz = waz_nbs if agedays == 0
(188 real changes made)
{\smallskip}
. 
. list visitweek gestage pma waz_* waz in f/10, noobs sep(10)
{\smallskip}
  {\TLC}\HLI{72}{\TRC}
  {\VBAR} visitw{\tytilde}k   gestage   pma   waz_nbs   waz_who      waz_png          waz {\VBAR}
  {\LFTT}\HLI{72}{\RGTT}
  {\VBAR}        0       132   133         .         .            .            . {\VBAR}
  {\VBAR}        1       132   139         .         .            .            . {\VBAR}
  {\VBAR}        2       132   146         .         .            .            . {\VBAR}
  {\VBAR}        4       132   162         .         .            .            . {\VBAR}
  {\VBAR}        6       132   174         .         .            .            . {\VBAR}
  {\VBAR}       10       132   203         .         .    7.8594946    7.8594946 {\VBAR}
  {\VBAR}       14       132   230         .         .    7.2548282    7.2548282 {\VBAR}
  {\VBAR}       18       132   258         .         .    6.0985216    6.0985216 {\VBAR}
  {\VBAR}       26       132   317         .         .    3.8344571    3.8344571 {\VBAR}
  {\VBAR}        0       237   238         .         .   -.43606208   -.43606208 {\VBAR}
  {\BLC}\HLI{72}{\BRC}
{\smallskip}
. drop waz_*
{\smallskip}
. 
. gen preterm = gestage < `37weeks'
{\smallskip}
. collapse waz, by(visitweek preterm)
{\smallskip}
. line waz visitweek if preterm == 0 || line waz visitweek if preterm == 1 ||, ///
>     title("WAZ in term/preterm infants in the LIFE study") ///
>     xtitle("Visit week") ///
>     ytitle("Weight-for-age z-score (WAZ)") ///
>     xlabel(0 1 2 4 6 10 14 18 26) ///
>     legend(label(1 "Term") label(2 "Preterm")) ///
>     scheme(sj)
{\smallskip}
. graph export "gigs_fig1.pdf"
file{\bftt{ gigs_fig1.pdf}} saved as PDF format
{\smallskip}
. 
. use life6mo, clear
{\smallskip}
. keep if (gestage - pma) == 0
(8,226 observations deleted)
{\smallskip}
. egen sga = classify_sga(meaninfwgt/1000), ///
>     gest_days(gestage) sex(sex) sexcode(m=1, f=2)
(2 missing values generated)
(2 missing values generated)
{\smallskip}
. gen term_status = "Preterm" if gestage < `37weeks'
(106 missing values generated)
{\smallskip}
. replace term_status = "Term" if gestage >= `37weeks'
(106 real changes made)
{\smallskip}
. graph bar (count), over(sga) by(term_status, ///
>     title("Size-for-GA category counts by term status") note("")) ///
>     ytitle("Frequency") ///
>     scheme(sj)
{\smallskip}
. graph export "gigs_fig2.pdf"
file{\bftt{ gigs_fig2.pdf}} saved as PDF format
{\smallskip}
